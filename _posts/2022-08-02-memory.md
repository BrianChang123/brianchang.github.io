---
layout: post
title: Memory 구조
subtitle: 
categories: computerScience
tags: computerScience memory
---

__프로그램이 운영체제로부터 할당받는 주기억장치(RAM)의 영역(Segment)에는 크게 4가지가 있다.__
1. __Code 영역__
2. __Data 영역__
3. __Stack 영역__
4. __Heap 영역__

---

![메모리영역][memory-map]


### 정적 Segement
#### Code 영역
1. 실행할 코드가 저장되는 영역. Text 영역이라고 함.
2. 컴파일된 기계어가 들어간다.
3. 프로그램이 종료될 때까지 메모리에 유지됨.
4. Read only 영역으로 작업이 들어오면 access violation 이 발생함.
5. 프로세스가 종료될 때 까지 메모리에 계속 남아있는 영역.


#### Data 영역
1. 프로그램의 전역변수(global)과 정적변수(static), 배열(array), 구조체(structure) 등이 저장되는 영역.
   1. 초기화 된 데이터: Data 영역에 저장
   2. 초기화 되지 않은 데이터: bss(block stated symbol)에 저장
2. 함수 내의 변수들은 Stack 영역에 저장됨.
3. 프로그램의 시작과 함께 할당되며 프로그램이 종료되면 소멸됨.


![스택-힙][stack_heap]

### 동적 Segment
#### Heap 영역
1. 프로그래머가 직접 관리하고 동적으로 사용하는 영역.
2. malloc, free, new, delete 등에 의해 할당되거나 반환되는 영역.
3. FIFI(First in First Out) 방식으로, 먼저 들어온 데이터가 먼저 인출됨.
4. Heap Overflow.
   - heap 이 위에서부터 주소값을 채워서 내려오다가 stack 영역을 침범하는 경우.

##### 장점 
- 런타임 시에 크기가 결정됨.  
- 메모리 크기 제한이 없음.

##### 단점
- 데이터 엑세스가 상대적으로 느리고, 메모리 관리가 필요.
- 할당, 해제 작업으로 인한 속도 저하 발생.
- 힙 손상으로 인한 속도 저하 발생.
  - 이중해제, 해제 후 블록 사용, 블록 경계를 벗어나 덮어쓰기 등
- 힙 경합으로 인한 속도 저하 발생.
  - 두개 이상의 스레드에서 데이터 엑세스 시도 시 경합 발생으로, 하나의 쓰레드가 완료될 때 까지 다른쪽 쓰레드의 작업이 중지됨. 
  - 현재 다중 프로세서 시스템에서 발생하는 큰 문제 중 하나.

#### Stack 영역
1. 프로그램이 자동으로 사용하는 임시 메모리.
2. 함수의 호출과 관계되는 지역변수, 매개변수, 복귀 번지 등이 저정되어 있는 영역.
3. 스택의 크기는 컴파일 시에 결정됨.
4. 함수의 호출과 함께 할당되며 함수 호출 완료 시 소멸함.
5. 스택 영역에 저장되는 함수의 호출 정보를 스택 프레임(stack frame)이라고 함
6. LIFI(Last in First Out) 방식으로 나중에 들어온 데이터가 먼저 인출됨.
7. push 로 데이털 저장. pop 으로 데이터 인출.
8. Stack Overflow.
   - stack 이 heap 영역을 침범.

##### 장점
- 데이터 액세스가 빠르고 변수를 명시적으로 할당, 해제 할 필요가 없음.
- 하나의 명령으로 메모리 조작과 어드레스 조작 가능.

##### 단점
- 크기에 제한이 있어(OS 별 상이) 한계를 초과하여 삽입이 불가능.
- 변수 크기 조정 불가.


__Heap 영역이 커지면 stack 영역이 작아지고, 그 반대도 성립한다__


#### Reference
1. <https://www.enqdeq.net/30>{: target="_blank"}
2. <https://velog.io/@xxhaileypark/Memory-%EA%B5%AC%EC%A1%B0-code-data-stack-heap>{: target="_blank"}
3. <https://all-young.tistory.com/17>{: target="_blank"}


[memory-map]:/assets/images/cs/memory_map.jpeg
[stack_heap]:/assets/images/cs/stack_heap.png
